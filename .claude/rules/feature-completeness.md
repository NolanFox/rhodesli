---
paths:
  - "app/main.py"
  - "core/registry.py"
  - "core/photo_registry.py"
---

# Feature Completeness Rule

Features must work end-to-end before marking done. A feature is NOT complete until:

1. **All identity states handled**: Any feature that displays or filters identities must handle ALL states (CONFIRMED, PROPOSED, INBOX, SKIPPED, CONTESTED, REJECTED). Test with each state â€” don't assume CONFIRMED-only.

2. **All entry points tested**: If a feature is reachable from multiple paths (sidebar, search, face overlay click, URL direct), test ALL entry points. The lightbox arrows broke 4 times because only one entry point was tested.

3. **Navigation preserves context**: Links generated by the feature must include the correct `section=` parameter derived from identity state (use `_section_for_state()`), any active `filter=` parameter, and any `triage_filter=` parameter. Never hardcode sections.

4. **Mobile tested**: If the feature has UI, verify it renders reasonably on mobile viewport (~375px). Check that text is readable, buttons are tappable, and modals don't overflow.

5. **Test coverage includes**:
   - Happy path (feature works)
   - Failure mode (missing data, wrong permissions)
   - Regression case (what would have caught this bug earlier)

6. **Data persistence verified**: If the feature writes data, verify it uses canonical save functions (`save_registry()`, `save_photo_registry()`), never `.save()` directly.
